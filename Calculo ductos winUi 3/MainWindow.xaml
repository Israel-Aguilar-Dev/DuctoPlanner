<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Calculo_ductos_winUi_3.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Calculo_ductos_winUi_3"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:controlPages="using:Calculo_ductos_winUi_3"
    xmlns:localConverter="using:Calculo_ductos_winUi_3.Services"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page>
        <Page.Resources>
            <DataTemplate x:Key="NavLinkItemTemplate" x:DataType="controlPages:NavLink">
                <Grid Margin="2,10,10,10" AutomationProperties.Name="{x:Bind Label}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="2*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <Image Source="{x:Bind ImageSource}" Width="36" Height="36" Grid.Column="0"/>
                    <TextBlock Text="{x:Bind Label}" TextWrapping="Wrap" Margin="24,8,0,8" VerticalAlignment="Center" Grid.Column="1"/>
                </Grid>
            </DataTemplate>
            <localConverter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
                
        </Page.Resources>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"></RowDefinition>
                <RowDefinition Height="*"></RowDefinition>
                <RowDefinition Height="Auto"></RowDefinition>
            </Grid.RowDefinitions>
            <CommandBar Grid.Row="0" HorizontalAlignment="Left" DefaultLabelPosition="Right">
                <CommandBar.PrimaryCommands>
                    <!-- Botones principales en la barra -->
                    <AppBarButton Icon="Document" Label="Nuevo" Click="NewFileButton_Click"/>

                    <AppBarButton x:Name="OpenButton" Icon="Folder" Label="Abrir">
                        
                    </AppBarButton>
                    <AppBarButton Icon="Save" Label="Guardar" Click="SaveButton_Click"/>
                    <AppBarButton Icon="Share" Label="Exportar" Click="ExportButton_Click" />

                </CommandBar.PrimaryCommands>
                
                <!-- Menú desplegable con más opciones -->
                <CommandBar.SecondaryCommands>
                    <AppBarButton Icon="Help" Label="Acerca de">
                        <AppBarButton.Flyout>
                            <Flyout>
                                <StackPanel Padding="10">
                                    <TextBlock Text="Ducto Planner" Margin="0,5,0,0"/>
                                    
                                    <TextBlock Text="{x:Bind StateApp.AppVersion}" />
                                </StackPanel>
                            </Flyout>
                        </AppBarButton.Flyout>
                    </AppBarButton>
                </CommandBar.SecondaryCommands>
            </CommandBar>
            <SplitView 
                x:Name="splitView" 
                PaneBackground="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
                IsPaneOpen="True" OpenPaneLength="210" CompactPaneLength="48" DisplayMode="Inline"
                Grid.Row="1"
                Grid.Column="1">
                <SplitView.Pane>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Menu" x:Name="PaneHeader" HorizontalAlignment="Center" Margin="0,12,0,0" Style="{StaticResource BaseTextBlockStyle}"/>
                        <ListView x:Name="NavLinksList" Margin="0,12,0,0" SelectionMode="Single" Grid.Row="1" VerticalAlignment="Stretch"
                            ItemClick="NavLinksList_ItemClick" IsItemClickEnabled="True"
                            ItemsSource="{x:Bind NavLinks}" ItemTemplate="{StaticResource NavLinkItemTemplate}"/>
                    </Grid>
                </SplitView.Pane>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Frame Grid.Row="1" x:Name="contentPage" CornerRadius="8,0,0,0"/>
                </Grid>
            </SplitView>
            <!-- Loader overlay -->
            <Grid x:Name="loader" Visibility="{x:Bind StateApp.Busy.IsVisible, Mode=OneWay}"
                    Background="#99000000" Canvas.ZIndex="999" Grid.Row="0" Grid.RowSpan="3">
                <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Padding="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"></RowDefinition>
                        <RowDefinition Height="Auto"></RowDefinition>
                    </Grid.RowDefinitions>
                    <ProgressRing Grid.Row="0" IsActive="{x:Bind StateApp.Busy.IsBusy, Mode=OneWay}" Width="60" Height="60"/>
                    <Image
                        Grid.Row="0"
                        Source="ms-appx:///Assets/IconoVertical-VERDE.png"
                        Width="20"
                        Height="20"
                        Stretch="Uniform"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center" />
                    <TextBlock Grid.Row="1" Text="{x:Bind StateApp.Busy.StatusMessage, Mode=OneWay}" Foreground="White" FontSize="16" TextAlignment="Center"/>
                </Grid>
            </Grid>
        </Grid>
        

        
    </Page>
    
</Window>
